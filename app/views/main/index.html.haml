- set_meta_tags title: t('shared.title')

- unless user_signed_in?
  .row
    .col-md-12
      .alert.alert-primary(role='alert')
        %p C 12 декабря незарегистрированным участникам ограничен свободный доступ к персональным данным.

- if @messages
  .row
    .col-md-12
      - @messages.each do |message|
        .alert.alert-primary(role='alert')
          %h4.alert-heading= message.title
          %p= simple_format message.content

.row
  .col.card-columns.main-blocks
    - if (can? :read, Member) && (!@bduser.empty? || !@bdusers_yesterday.empty? || !@bdusers_prevyesterday.empty?)
      .card
        - unless @bdusers_prevyesterday.empty?
          .card-header
            = t 'shared.birthdays_prevyesterday'
          .card-body
            - @bdusers_prevyesterday.keys.sort.each do |u|
              = render @bdusers_prevyesterday[u], bdclass: nil, turntext: t('member.turned'), should_be_age: false

        - unless @bdusers_yesterday.empty?
          .card-header
            = t 'shared.birthdays_yesterday'
          .card-body
            - @bdusers_yesterday.keys.sort.each do |u|
              = render @bdusers_yesterday[u], bdclass: nil, turntext: t('member.turned'), should_be_age: false

        - unless @bdusers_today.empty?
          .card-header
            = @bdusers_today.keys.count > 1 ? t('shared.birthdays_today') : t('shared.birthday_today')
          .card-body.animated.rubberBand
            - @bdusers_today.keys.sort.each do |u|
              = render @bdusers_today[u], bdclass: 'alert alert-success', turntext: t('member.turn'), should_be_age: false

        - unless @bdusers_tomorrow.empty?
          .card-header
            = t 'shared.birthdays_tomorrow'
          .card-body
            - @bdusers_tomorrow.keys.sort.each do |u|
              = render @bdusers_tomorrow[u], bdclass: nil, turntext: t('member.willturn'), should_be_age: ((DateTime.now.year + 1.month) > DateTime.now.year) ? true : false

        - unless @bdusers_month.empty?
          .card-header
            = @bdusers_month.keys.count > 1 ? t('shared.birthdays') : t('shared.birthday')
          .card-body
            - @bdusers_month.keys.sort.each do |u|
              = render @bdusers_month[u], bdclass: nil, turntext: t('member.willturn'), should_be_age: ((DateTime.now.year + 1.month) > DateTime.now.year) ? true : false
    - if user_signed_in?
      - if !@holidays_today.empty? || !@holidays_tomorrow.empty?
        .card
          - unless @holidays_today.empty?
            .card-header
              = t 'shared.today'
              %span.text-muted= Russian.strftime(DateTime.now, '%d %B')
            .card-body
              - @holidays_today.each do |holiday|
                .text-success.mb-2= holiday[:name]
          - unless @holidays_tomorrow.empty?
            .card-header
              = t 'shared.tomorrow'
              %span.text-muted= Russian.strftime(DateTime.tomorrow, '%d %B')
            .card-body
              - @holidays_tomorrow.each do |holiday|
                .mb-2= holiday[:name]

      - unless @events.empty? && @events_soon.empty?
        .card
          - unless @events.empty?
            .card-header
              = link_to t('events.list'), [current_user, Event]
            .card-body
              .row
                .col-12= render partial: 'events/event_mini', collection: @events, locals: { diff_dates: false }

          - unless @events_soon.empty?
            .card-header
              = t 'events.future'
            .card-body
              .row
                .col-12= render partial: 'events/event_mini', collection: @events_soon, locals: { diff_dates: true }

    - if user_signed_in?
      .card
        - if current_user.member
          .card-header
            = t 'vacations.my'
            = link_to manage_holidays_member_path(current_user.member),
              class: 'float-right btn btn-light border btn-sm',
              data: { toggle: 'tooltip' },
              title: t('shared.edit') do

              = fa_icon 'edit'
            .clearfix
          - if @current_vacation
            .card-body= t 'vacations.you_rest'

          - elsif @current_vacations_soon
            .card-body
              - count_days = (DateTime.now.beginning_of_day..@current_vacations_soon.startdate.beginning_of_day).count - 1
              = t('vacations.diff_days', till: plural(count_days, 'till', false), count: plural(count_days, 'day'))
              = t('vacations.start',
                date: Russian.strftime(@current_vacations_soon.startdate, "%e %B"),
                diff: plural(TimeDifference.between(@current_vacations_soon.enddate + 1.day, @current_vacations_soon.startdate).in_days.to_i, 'day'))

        - unless @vacations.empty?
          .card-header
            = t 'vacations.index'
          .card-body
            .row
              .col-2.col-md-3
                = image_tag 'umbrella.png', class: 'img-fluid'
              .col-10.col-md-9
                - @vacations.each do |v|
                  .mb-2
                    = v.member.fullname
                    = t('vacations.until', date: Russian.strftime(v.enddate + 1.day, "%e %B"))

        - unless @vacations_soon.empty?
          .card-header
            = t 'vacations.soon'
          .card-body
            .row
              .col-2.col-md-3
                = image_tag 'chemodan.png', class: 'img-fluid'
              .col-10.col-md-9
                - @vacations_soon.each do |v|
                  .mb-2
                    = v.member.fullname
                    = t('vacations.start',
                      date: Russian.strftime(v.startdate, "%e %B"),
                      diff: plural(TimeDifference.between(v.enddate + 1.day, v.startdate).in_days.to_i, 'day'))

    - unless @docs.empty?
      .card
        .card-header= t 'docs.last_docs'
        .card-body
          .row= render partial: 'docs/mini_doc', collection: @docs
