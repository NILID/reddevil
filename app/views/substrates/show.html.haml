- set_meta_tags title: @substrate.title

.card
  .card-body
    .row
      .col-12
        = render 'breadcrumb', titles: [@substrate.title]
      .col-12.mb-2
        = link_to edit_substrate_path(@substrate), class: 'btn btn-outline-primary btn-sm mr-1' do
          = fa_icon 'edit', text: t('shared.edit')
        = link_to changes_substrate_path(@substrate), class: 'btn btn-outline-primary btn-sm' do
          = fa_icon 'history', text: t('shared.history')
    .row
      .col
        %dl.row
          %dt.col-sm-3= Substrate.human_attribute_name(:priorityx)
          %dd.col-sm-9= new_priority_tag @substrate.priorityx
          %dt.col-sm-3= Substrate.human_attribute_name(:status)
          %dd.col-sm-9= status_text(@substrate.status)
          %dt.col-sm-3= t('substrates.created_at')
          %dd.col-sm-9= l @substrate.created_at, format: :long
          %dt.col-sm-3= Substrate.human_attribute_name(:desc)
          %dd.col-sm-9= @substrate.desc
      .col
        .row
          .col
            .h5.text-muted
              = t 'substrates.followers'
          .col.text-right
            = link_to '#manage_followers', class: 'btn btn-sm btn-outline-secondary', data: { toggle: 'modal', target: '#manage_followers' } do
              = fa_icon 'users', text: t('substrates.followers_manage')
        .row
          .col
            %hr
            #followers_small
              = render partial: 'follow_user_small',
                collection: @followers,
                as: :user,
                locals: { substrate: @substrate }
        - if @substrate.finished_at?
          .row.mt-3
            .col
              %b= Substrate.human_attribute_name(:finished_at)
              = short_date @substrate.finished_at

    .row
      .col-12
        %hr
        .h5.text-muted= t('shared.information')
        %hr
      .col
        %table.table.table-striped.table-sm
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:drawing)
            %td= @substrate.drawing
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:detail)
            %td= @substrate.detail
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:amount)
            %td
              %div
                %span.text-muted= t('substrates.instock_search')
                %strong= @substrate.instock
              %div
                %span.text-muted= t('substrates.amount_search')
                %strong= @substrate.amount
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:ready_count)
            %td= @substrate.ready_count
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:propotions)
            %td= @substrate.propotions
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:frame)
            %td= t("substrates.frame_#{@substrate.frame}")
          %tr
            %th(scope="row")= Substrate.human_attribute_name(:rad_strength)
            %td= @substrate.rad_strength

        %p
          %table.table
            %thead
              %tr
                %th= Substrate.human_attribute_name(:sides)
                %th= t('substrates.coating_type')
                %th= t('substrates.wave')
                %th= t('substrates.corner')
            %tbody
              %tr
                %td
                  %strong А
                %td= @substrate.coating_type
                %td= @substrate.wave
                %td= @substrate.corner
              %tr
                %td
                  %strong Б
                %td= @substrate.coating_type_b
                %td= @substrate.wave_b
                %td= @substrate.corner_b

      .col
        %dl.row
          %dt.col-sm-4= Substrate.human_attribute_name(:contract)
          %dd.col-sm-8= @substrate.contract
          %dt.col-sm-4= Substrate.human_attribute_name(:arrival_at)
          %dd.col-sm-8= short_date @substrate.arrival_at if @substrate.arrival_at
          %dt.col-sm-4= Substrate.human_attribute_name(:arrival_from)
          %dd.col-sm-8= @substrate.arrival_from
          %dt.col-sm-4= Substrate.human_attribute_name(:future_shipping_at)
          %dd.col-sm-8= short_date @substrate.future_shipping_at if @substrate.future_shipping_at
          %dt.col-sm-4= Substrate.human_attribute_name(:shipping_at)
          %dd.col-sm-8= short_date @substrate.shipping_at if @substrate.shipping_at
          %dt.col-sm-4= Substrate.human_attribute_name(:shipping_to)
          %dd.col-sm-8= @substrate.shipping_to
          %dt.col-sm-4= Substrate.human_attribute_name(:shipping_base)
          %dd.col-sm-8= @substrate.shipping_base
          %dt.col-sm-4= Substrate.human_attribute_name(:user)
          %dd.col-sm-8= link_to @substrate.author, @substrate.user

    .row
      .col
        %hr
        .h4.text-muted
          = t 'subfiles.title'
          %small
            .btn.btn-sm.btn-outline-secondary(data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample")
              = fa_icon 'file', text: t('subfiles.add'), class: 'mr-2'

        .row.collapse#collapseExample
          .col
            .my-3= render partial: 'subfiles/form', locals: { substrate: @substrate, subfile: Subfile.new }

        %table.table.table-striped.table-hover.table-sm
          = content_tag_for(:tr, @subfiles) do |subfile|
            %td
              = link_to subfile.src_file_name, subfile.src.url, target: '_blank'
            %td
              = link_to subfile.user.surname_name, subfile.user
            %td
              = link_to [@substrate, subfile], method: :delete, remote: true, class: 'btn btn-sm btn-danger', data: { confirm: t('shared.sure') } do
                = fa_icon 'trash'


.modal.fade#manage_followers(role='dialog' tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
  .modal-dialog
    .modal-content
      .modal-header
        .lead= t 'substrates.followers_manage_full'
      .modal-body
        .row
          .col.border-right
            .h6.text-muted= t 'substrates.followers_future'
            %ul.list-group.list-group-flush#future_followers
              = render partial: 'follow_user',
                collection: @users,
                as: :user,
                locals: { substrate: @substrate, marker: :plus }
          .col
            .h6.text-muted= t 'substrates.followers'
            %ul.list-group.list-group-flush#followers
              = render partial: 'follow_user',
                collection: @followers,
                as: :user,
                locals: { substrate: @substrate, marker: :minus }
