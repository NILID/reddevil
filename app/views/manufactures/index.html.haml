.card
  .card-header
    = render 'application/breadcrumb', titles: [], class_name: Manufacture do
      .float-right
        = link_to '#search-form-collapse', data: { toggle: params[:q] ? '' : 'collapse' }, class: 'btn btn-outline-primary btn-sm' do
          = fa_icon 'filter', text: t('shared.filter')
        = link_to fa_icon(:stream, text: t('operations.title')), operations_path, class: 'btn btn-success btn-sm  ml-2'

  .card-body
    = render 'manufactures/search_form'
    = link_to new_manufacture_group_path, class: 'btn btn-outline-primary mb-2' do
      = fa_icon(:plus, text: t('manufacture_groups.add'))
    - if @manufactures.empty?
      .text-center.my-5
        .h3.text-muted= t('shared.search_empty')
    - else
      .row.text-muted
        .col
          .row
            .col
              .p-2= ManufactureGroup.human_attribute_name(:title)
            .col
              .p-2= ManufactureGroup.human_attribute_name(:contract)
            .col-3
              .p-2= ManufactureGroup.human_attribute_name(:limit_at)
        .col-2

      .accordion.manufactures#accordionGroups
        - @groups.each_with_index do |group, index|
          .card.bg-light
            .card-header{id: "group_#{index}" }
              .row
                .col
                  .row.pointer{data: { toggle: 'collapse', target: "#collapse_group_#{index}"}, aria: { expander: 'true', controls: "collapse_group_#{index}" }}
                    .col
                      .lead= group.title
                    .col
                      .lead= group.contract
                    .col-3
                      .lead= short_date_with_month(group.limit_at) if group.limit_at
                .col-2.text-right
                  = link_to new_manufacture_path(manufacture_group_id: group), class: 'btn btn-outline-primary btn-sm ml-2' do
                    = fa_icon :plus, text: Manufacture.model_name.human
                  = link_to edit_manufacture_group_path(group), class: 'btn btn-outline-primary btn-sm ml-2' do
                    = fa_icon :cog

            .collapse{ id: "collapse_group_#{index}", aria: { labelledby: "group_#{index}" }, data: { parent: '#accordionGroups' } }
              .accordion{ id: "accordion_groups_#{index}" }

                .row.text-muted
                  .col-1
                  .col-1
                    .p-2= t('substrates.otk')
                  .col
                    .p-2= Manufacture.human_attribute_name(:title)
                  .col
                    .p-2= Manufacture.human_attribute_name(:operation)
                  .col
                    .p-2= Manufacture.human_attribute_name(:user)
                  .col
                    .p-2= ManufactureOperation.human_attribute_name(:started_at)
                  .col
                    .p-2= ManufactureOperation.human_attribute_name(:finished_at)


                = render group.manufactures, index: index
      .accordion.mt-3{ id: "accordion_groups_0" }
        = render Manufacture.where(manufacture_group_id: nil), index: 0