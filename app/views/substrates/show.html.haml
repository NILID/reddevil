.card
  .card-body
    .row
      .col-12
        = render 'breadcrumb', titles: [@substrate.title]
      .col-12.mb-2
        = link_to edit_substrate_path(@substrate), class: 'btn btn-outline-primary btn-sm mr-1' do
          = fa_icon 'edit', text: t('shared.edit')
        = link_to changes_substrate_path(@substrate), class: 'btn btn-outline-primary btn-sm' do
          = fa_icon 'history', text: t('shared.history')
    .row
      .col
        %p
          %b= Substrate.human_attribute_name(:priority)
          = priority_tag @substrate.priority
        %p
          %b= Substrate.human_attribute_name(:status)
          = status_text(@substrate.status)
        %p
          %b= t('substrates.created_at')
          = l @substrate.created_at, format: :long
        %p
          %b= Substrate.human_attribute_name(:desc)
          = @substrate.desc
      .col
        .row
          .col
            .h5.text-muted
              = t 'substrates.followers'
          .col.text-right
            = link_to '#manage_followers', class: 'btn btn-sm btn-outline-secondary', data: { toggle: 'modal', target: '#manage_followers' } do
              = fa_icon 'users', text: t('substrates.followers_manage')
        .row
          .col
            %hr
            #followers_small
              = render partial: 'follow_user_small',
                collection: @substrate.followers(User),
                as: :user,
                locals: { substrate: @substrate }
        - if @substrate.finished_at?
          .row.mt-3
            .col
              %b= Substrate.human_attribute_name(:finished_at)
              = short_date @substrate.finished_at

    .row
      .col-12
        %hr
        .h5.text-muted= t('shared.information')
        %hr
      .col
        %p
          %b= Substrate.human_attribute_name(:drawing)
          = @substrate.drawing
        %p
          %b= Substrate.human_attribute_name(:detail)
          = @substrate.detail
        %p
          %b= Substrate.human_attribute_name(:amount)
          = @substrate.amount
        %p
          %table.table
            %thead
              %tr
                %th= Substrate.human_attribute_name(:sides)
                %th= t('substrates.coating_type')
                %th= t('substrates.wave')
                %th= t('substrates.corner')
            %tbody
              %tr
                %td
                  %strong А
                %td= @substrate.coating_type
                %td= @substrate.wave
                %td= @substrate.corner
              %tr
                %td
                  %strong Б
                %td= @substrate.coating_type_b
                %td= @substrate.wave_b
                %td= @substrate.corner_b

        %p
          %b= Substrate.human_attribute_name(:propotions)
          = @substrate.propotions
        %p
          %b= Substrate.human_attribute_name(:frame)
          = t("substrates.frame_#{@substrate.frame}")
      .col
        %p
          %b= Substrate.human_attribute_name(:contract)
          = @substrate.contract
        %p
          %b= Substrate.human_attribute_name(:arrival_at)
          = short_date @substrate.arrival_at if @substrate.arrival_at
        %p
          %b= Substrate.human_attribute_name(:arrival_from)
          = @substrate.arrival_from
        %p
          %b= Substrate.human_attribute_name(:future_shipping_at)
          = short_date @substrate.future_shipping_at if @substrate.future_shipping_at
        %p
          %b= Substrate.human_attribute_name(:shipping_at)
          = short_date @substrate.shipping_at if @substrate.shipping_at
        %p
          %b= Substrate.human_attribute_name(:shipping_to)
          = @substrate.shipping_to
        %p
          %b= Substrate.human_attribute_name(:shipping_base)
          = @substrate.shipping_base
        %p
          %b= Substrate.human_attribute_name(:user)
          = link_to @substrate.author, @substrate.user

    .row
      .col
        %hr
        .h4.text-muted
          = t 'subfiles.title'
          %small
            .btn.btn-sm.btn-outline-secondary(data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample")
              = fa_icon 'file', text: t('subfiles.add'), class: 'mr-2'

        .row.collapse#collapseExample
          .col
            .my-3= render partial: 'subfiles/form', locals: { substrate: @substrate, subfile: Subfile.new }

        %table.table.table-striped.table-hover.table-sm
          = content_tag_for(:tr, @subfiles) do |subfile|
            %td
              = link_to subfile.src_file_name, subfile.src.url, target: '_blank'
            %td
              = link_to subfile.user.surname_name, subfile.user
            %td
              = link_to [@substrate, subfile], method: :delete, remote: true, class: 'btn btn-sm btn-danger', data: { confirm: t('shared.sure') } do
                = fa_icon 'trash'


.modal.fade#manage_followers(role='dialog' tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
  .modal-dialog
    .modal-content
      .modal-header
        .lead= t 'substrates.followers_manage_full'
      .modal-body
        .row
          .col.border-right
            .h6.text-muted= t 'substrates.followers_future'
            %ul.list-group.list-group-flush#future_followers
              = render partial: 'follow_user',
                collection: @users,
                as: :user,
                locals: { substrate: @substrate, marker: :plus }
          .col
            .h6.text-muted= t 'substrates.followers'
            %ul.list-group.list-group-flush#followers
              = render partial: 'follow_user',
                collection: @substrate.followers(User),
                as: :user,
                locals: { substrate: @substrate, marker: :minus }
